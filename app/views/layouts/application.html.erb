<!DOCTYPE html>
<html>
<head>
	<% if content_for?(:title) %>
		<title><%= yield(:title) %> | Vendox</title>
	<% else %>
		<title>Vendox</title>
	<% end %>
	<%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
	<%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
	<%= csrf_meta_tags %>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="description" content="<%= t('site_description') %>">
	<meta name="keywords" content="Locationbased,Standortbasiert,Finder,Produkt">
	<%= yield :head %>
	<%= favicon_link_tag '/logo/favicon.png' %>
	<%= favicon_link_tag '/logo/ios-favicon.png', rel: 'apple-touch-icon', type: 'image/png' %>
	<script src="//maps.google.com/maps/api/js" type="text/javascript"></script>
	<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>
</head>
<body>

<%= render 'shared/navbar' %>

<%= render 'shared/messages' %>

<div class="container">
	<%= yield %>

	<%= render 'shared/footer' %>
</div>

<script type="text/javascript">
$(function() {
	user_address = "<%= user_address %>"

	if (typeof Cookies.get("session_token") === 'undefined') {
		var path = "/api/v1/users/sessions"

		var data = {
			"device": navigator.userAgent
		}

		$.ajax({
			url: path,
			type: 'post',
			data: data,
			dataType: 'json'
		}).done(function(data, status) {
			Cookies.set("session_token", data["token"])

			session_token = data["token"]

			if (user_address === "") {
				$(".current-location-wrapper").hide();

				autoLocation();
			}
		})
	} else {
		session_token = Cookies.get("session_token")

		if (user_address === "") {
			$(".current-location-wrapper").hide();

			autoLocation();
		}
	}
});
</script>

<% if Rails.env.development? %>
	<%= console %>
<% end %>

</body>
</html>
