<!DOCTYPE html>
<html>
<head>
	<title>Vendox</title>
	<%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
	<%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
	<%= csrf_meta_tags %>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="description" content="<%= t('site_description') %>">
	<meta name="keywords" content="Locationbased,Standortbasiert,Finder,Produkt">
	<%= favicon_link_tag '/logo/favicon.png' %>
	<%= favicon_link_tag '/logo/ios-favicon.png', rel: 'apple-touch-icon', type: 'image/png' %>
	<script src="//maps.google.com/maps/api/js" type="text/javascript"></script>
	<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>
</head>
<body>

<%= render 'shared/navbar' %>

<%= render 'shared/messages' %>

<div class="container">
	<%= yield %>

	<%= render 'shared/footer' %>
</div>


<script type="text/javascript">
	<% if not current_user_location && !current_user_location_expired? %>
		$(function() {
			autoLocation();
		});
	<% end %>


	function autoLocation() {
		if (navigator.geolocation) {
	        navigator.geolocation.getCurrentPosition(setPosition);
	    }
	}

    function setPosition(position) {
    	geocoder = new google.maps.Geocoder();
    	latLng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);

    	geocoder.geocode({ location: latLng }, function(results, status) {
    		if (status == google.maps.GeocoderStatus.OK) {
    			$.get("/position?lng=" + position.coords.longitude + "&lat=" + position.coords.latitude + "&addr=" + results[0].formatted_address, function(data, status) {
		    		$('.current-location-info').html(data)

		    		if($('.current-location-field').length) {
		    			$('.current-location-field').val(results[0].formatted_address)
		    		}
		    	});
    		}
    	});
    }
</script>


<% if Rails.env.development? %>
	<%= console %>
<% end %>

</body>
</html>
